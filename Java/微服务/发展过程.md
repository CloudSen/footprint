# 微服务架构

## 概念

### 分布式

> 从物理资源的角度去将不同的机器组成一个整体对外服务，技术范围非常广且难度非常大，有了这个基础，高并发、高吞吐等系统很容易构建。  

为了解决单个物理服务器容量和性能瓶颈问题而采用的优化手段。  

- 水平扩展：添加机器，部署相同项目，分流请求；
- 垂直扩展：将不同业务部署到不同机器，分别处理不同的请求；



### 高并发

> 从业务角度去描述系统的能力，实现高并发的手段可以采用分布式，也可以采用诸如缓存、CDN等，当然也包括多线程。

同时处理大量的请求。高并发可以通过分布式技术去解决，将并发流量分到不同的物理服务器上。  



### 多线程

> 聚焦于如何使用编程语言将CPU调度能力最大化。

多线程是指从软件或者硬件上实现多个线程并发执行的技术，它更多的是解决CPU调度多个进程的问题，从而让这些进程看上去是同时执行（实际是交替运行的）。  



### 集群

同一个应用部署到很多台不同的服务器。形成一个服务器群。  



### 负载均衡

当集群收到一个请求时，由一个调控者来根据各个服务器的负载情况，选择一个负载最低的服务器，来处理当前请求。  



### 微服务

> 根据业务模块划分服务种类。 每个服务可以独立部署并且互相隔离。 通过轻量的 API 调用服务。 服务需要保证良好的高可用性。

集群是将一个应用整体横向扩展。微服务是根据单一职责，将每个业务都做成一个应用，并分别部署，服务之间相互协调、互相配合。服务之间采用轻量级的通信机制，如Restful API或RPC。  



### 注册中心

> 分布式系统核心组件

注册中心可以说是微服务架构中的”通讯录“，它记录了服务和服务地址的映射关系。在分布式架构中，服务会注册到这里，当服务需要调用其它服务时，就这里找到服务的地址，进行调用。  



## 问题

- 服务雪崩
- 请求堆积，故障恢复慢
- 服务器资源分配困难
- 不太好搭建测试环境和开发环境

- 性能监控
- 服务间通信成本高
- 运维的压力



## 技术栈

- 服务开发：Spring Boot
- 服务配置与管理：Netflix公司的Archaius、阿里的Diamond等
- 服务注册与发现：Eureka、Zookeeper、Consul等
- 服务调用：REST、RPC等
- 服务熔断器：Hystrix、Envoy等
- 负载均衡：Nginx、Ribbon
- 服务接口调用：Feign等
- 服务缓存：Redis等
- 消息队列：RabbitMQ、Kafka、ActiveMQ
- 服务配置中心管理：Spring Cloud Config、Chef等
- 服务路由(API网关)：Zuul等
- 服务监控：Zabbix、Nagios、Metrics、Spectator
- 全链路追踪：Zipkin、Brave、Dapper等
- 服务部署：Docker等
- 数据流操作开发包：SpringCloud Stream(封装与Redis、Rabbit、Kafka等发送接收消息)
- 事件消息总线：SpringCloud Bus