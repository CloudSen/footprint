# Ribbon Load Balancer 负载均衡

Spring Cloud Ribbon是基于Netflix Ribbon实现的一套***客户端负债均衡***的工具。  

它提供了***客户端的软件负载均衡算法*** ，也可以很容易的加入自定义的负载均衡算法，拥有一系列完善的配置项如连接超时，重试等。  

> 负载均衡的算法规则一般有：简单轮询、随即连接、根据相应时间加权等。  
>
> Ribbon默认使用轮询算法。  

## IRule 负载均衡算法接口

默认提供了以下几种LB算法实现类：  

- RoundRobinRule：默认规则，轮询；

- RandomRule：随机；

- AvailabilityFilteringRule：

- WeightedResponseTimeRule：

  根据平均相应时间加权重，相应时间越快，权重越高；  

  刚启动时若统计信息不足，则使用RoundRobinRule，直到信息充足；

- RetryRule：

  先按照RoundRobinRule获取服务，若获取失败，则在指定时间内会进行重试；

- BestAvailableRule：

- ZoneAvoidanceRule：复合判断服务所在区域的性能和可用性选择服务器；

## 自定义算法

使用 `@RibbonClient` 注解指定某个微服务使用自定义算法。  

```java
@RibbonClient(name="微服务名", configuration=自定义算法.class)
```

> 注意：自定义算法类，不能放在 `@ComponentScan` 所扫描的包和子包下。  
>
> 也就是不要和Spring Boot启动类在同一个包下，要重新建一个独立的包。  

